{% extends "base.html" %}

{% block head %}
    <title>{{ page.title }} | Cloudsalat</title>

    {% if page.extra.map %}
    <link rel="stylesheet" href="{{ get_url(path='leaflet.css') }}" type="text/css">
    <script src="{{ get_url(path='leaflet.js') }}"></script>
    {% endif %}
{% endblock head %}

{% block content %}
<p>
    <span class="blog-meta">{{ page.date }}</span>

    {% if page.extra.map %}
    <a id="map-toggle" href="javascript:void(0)">Toggle map</a>
    <div id="map"></div>

    <script type="text/javascript">
        const mapToggle = document.getElementById("map-toggle");
        mapToggle.onclick = () => {
            const map = document.getElementById("map");
            const style = window.getComputedStyle(map);
            const display = style.getPropertyValue("display");

            const toggled = display === "block" ? "none" : "block";
            map.style.display = toggled;
        };

        const map = L.map("map").setView({{ page.extra.location }}, 8);
        L.tileLayer("{{ config.extra.map_tile_url | safe }}", {
            maxZoom: 18,
            attribution: '{{ config.extra.map_tile_attribution | safe }}'
        }).addTo(map);
        L.marker({{ page.extra.location }}).addTo(map);
    </script>
    {% endif %}
</p>

<h1>{{ page.title }}</h1>
{{ page.content | safe }}
{% endblock content %}
